# Инструкция по применению миграции для админов

## Проблема
После деплоя не отображаются поля "Офис" и "Разрешения" в модальном окне админа.

## Решение
Нужно применить миграцию в базе данных MySQL.

### Вариант 1: Безопасная миграция (рекомендуется)
Используйте файл `car-api/migrations/add_admin_project_and_permissions_safe.sql`

Эта миграция:
- Проверяет существование колонок перед добавлением
- Обновляет всех активных админов
- Можно запускать многократно без ошибок

### Вариант 2: Простая миграция
Используйте файл `car-api/migrations/add_admin_project_and_permissions.sql`

**Внимание:** Если колонки уже существуют, будет ошибка.

## Как применить миграцию

### Через MySQL CLI:
```bash
mysql -h YOUR_HOST -u YOUR_USER -p YOUR_DATABASE < car-api/migrations/add_admin_project_and_permissions_safe.sql
```

### Через phpMyAdmin или другой GUI:
1. Откройте файл `car-api/migrations/add_admin_project_and_permissions_safe.sql`
2. Скопируйте содержимое
3. Выполните SQL запрос в вашей базе данных

### Через Railway (если используется):
1. Подключитесь к базе данных через Railway CLI или веб-интерфейс
2. Выполните SQL из файла миграции

## Что делает миграция:
1. Добавляет колонку `projectId` типа ENUM('office_1', 'office_2') с дефолтным значением 'office_1'
2. Добавляет колонку `permissions` типа JSON
3. Устанавливает для всех активных админов:
   - `projectId = 'office_1'`
   - Все 4 разрешения в `true`:
     - `canAddCars: true`
     - `canViewCars: true`
     - `canManageLeads: true`
     - `canViewLeads: true`

## Проверка после миграции:
После применения миграции проверьте:
1. Откройте модальное окно админа
2. Должен отображаться "Офис 1" вместо "Не назначен"
3. Все разрешения должны быть "Разрешено" вместо "Запрещено"

Если проблема сохраняется:
1. Проверьте консоль браузера (F12) - должны быть логи с данными админа
2. Проверьте, что API возвращает `projectId` и `permissions` в ответе
3. Убедитесь, что миграция выполнена успешно

